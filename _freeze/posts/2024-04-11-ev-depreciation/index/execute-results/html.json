{
  "hash": "320392048460c3a3d5f403aea0050654",
  "result": {
    "markdown": "---\ntitle: \"Are electric cars a worse investment ?\"\ndescription: \"This post examines the value depreciation of electric vehicle (EV) in the Montreal area, with an analysis of the impact of the Quebec government's decision to phase out the Roulez Vert program on the value.\"\ndate: \"4/11/2024\"\ncategories:\n  - Data Science\ncitation: true\n---\n\n\n\nElectric vehicles (EVs) are generaly more expensive than their gasoline counterpart. Yet, adoption has still be relatively high thanks to governement incentives and the cheap cost of electricity in the province of Quebec. But, as the [Roulez Vert](https://www.quebec.ca/transports/transport-electrique/aide-financiere-vehicule-electrique/services-en-ligne-roulez-vert) program from the government of Quebec is slowly getting phased out, it is worth examining more precicely the financial impact of EVs. The program's initial goal was to promote EVs with monetary incentives (up to $7,000 CAD for new cars and $3,500 CAD for used cars). Removing this program means that every EV purchased starting on January 1, 2025, will be more expensive.\n\nThis presents a unique opportunity for acquiring an EV this year with a lower value depreciation than what would traditionally be expected, as the cost of EVs will slowly increase over the next few years. That is, of course, under the assumption that the cost of new EVs will remain relatively stable over the next few years.\n\nMy understanding of EVs is that they should hold value longer than your typical gasoline vehicle. There are fewer parts involved in the engine, and the battery capacity can remain relatively stable over a huge number of recharge cycles. The brake pads can be changed less often thanks to the regenerative braking system. Rusting should be roughly similar to gasoline vehicles. The main disadvantage is that battery capacity has been increasing significantly with every new generation of EVs. Therefore, there is an incentive to upgrade your car and thus saturate the used EV market, which decreases prices and depreciates the value of the car faster.\n\nBefore making any assumptions, it is best to refer to data to see how, with a constant government incentive over the past few years, the EVs in the Montreal market area have been depreciating in value using gasoline vehicles as a baseline.\n\n\n## Acquiring used vehicle market data\n\nTo do so, I first scraped some used vehicle market data using the [Web Scraper Chrome extension](https://www.webscraper.io/). I then used the [US car models GitHub repository](https://github.com/AbhiOnlyOne/us-car-models-data) to parse the vehicle make and model out of the text description for each vehicle.\n\nHere are the first 5 rows of this new dataset:\n\n::: {.cell execution_count=2}\n``` {.python .cell-code}\n# Code for parsing us-car-models-data (make and models)\nus_car_models_df = None\nfor file in glob.glob(\"data/us-car-models/*.csv\"):\n    current_year = pd.read_csv(file)\n    if us_car_models_df is None:\n        us_car_models_df = current_year\n    else:\n        us_car_models_df = pd.concat([us_car_models_df, current_year])\n\nall_cars_models = us_car_models_df.model.unique().tolist()\nall_cars_models = sorted(all_cars_models, key=len, reverse=True)\n\n# Code for parsing scaped vehicle data\nevs = pd.read_csv(\"data/electric_cars.csv\")\ngas = pd.read_csv(\"data/gasoline_cars.csv\")\nevs[\"engine_type\"] = \"electric\"\ngas[\"engine_type\"] = \"gasoline\"\ndf = pd.concat([evs, gas]).drop_duplicates()\n\ndf[\"vehicle-name\"] = df[\"vehicle-name\"].str.strip()\ndf[\"year\"] = df[\"vehicle-name\"].str[:4].astype(float)\ndf[\"price\"] = (\n    df[\"price\"].str.extract(\"([\\d,]+)\", expand=False).str.replace(\",\", \"\").astype(float)\n)\n\n\ndf = df[df[\"year\"] > 2010]\ndf[\"make\"] = df[\"vehicle-name\"].str.extract(\"\\d+\\s+([A-Za-z\\-]+)\\s\", expand=False)\n\ndef find_model_in_paragraph(text):\n    reg = re.compile('[^a-z0-9]')\n    for model in all_cars_models:\n        if reg.sub('', model.lower()) in reg.sub('', text.lower()):\n            return model\n    return None\n\ndf[\"model\"] = df[\"vehicle-name\"].apply(find_model_in_paragraph)\n\ndf[\"mileage\"] = df.mileage.str.replace(\"[km,]\", \"\", regex=True).astype(float)\ndf[\"vehicle_age\"] = 2025 - df.year\ndf.drop(\n    [\"vehicle-name\", \"vehicle-desc\", \"pagination\", \"web-scraper-order\", \"web-scraper-start-url\"], axis=1, inplace=True\n) # drop unwanted columns\ndf.dropna(inplace=True)\ndf.year = df.year.astype(int)\n\nprint(df.head(5))\ndf[\"MakeModel\"] = (df[\"make\"] + \" \" + df[\"model\"]).astype(\"category\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   mileage    price engine_type  year       make      model  vehicle_age\n0  27707.0  24995.0    electric  2022      Mazda      MX-30          3.0\n1   5923.0  58995.0    electric  2023       Audi  Q4 e-tron          2.0\n2  66068.0  22988.0    electric  2018  Chevrolet    Bolt EV          7.0\n3  45669.0  30985.0    electric  2020        Kia     Optima          5.0\n4  39169.0  38895.0    electric  2022    Hyundai        Ion          3.0\n```\n:::\n:::\n\n\n## Data visualization\n\nWe can start our analysis with some visualization of this newly created dataset.\n\n::: {.cell execution_count=3}\n``` {.python .cell-code}\nfig, axs = plt.subplots(2, 2, figsize=(10, 8), tight_layout=True)\n\n# Vehicle age\nhist_data = np.unique(df.vehicle_age, return_counts=True)\naxs[0][0].bar(*hist_data, edgecolor=\"black\", align=\"center\")\naxs[0][0].set_xlabel(\"Vehicle age\")\naxs[0][0].set_ylabel(\"Count\")\n\n# Engine type\nhist_data = np.unique(df.engine_type, return_counts=True)\naxs[0][1].bar(*hist_data, edgecolor=\"black\", align=\"center\")\naxs[0][1].set_xlabel(\"Engine type\")\naxs[0][1].set_ylabel(\"Count\")\n\n# Mileage\nbin_size = 5000\nbins, counts = np.unique(df.mileage.astype(int)//bin_size, return_counts=True)\nbins *= bin_size\naxs[1][0].bar(bins/1000, counts, edgecolor=\"black\", align=\"center\", width=bin_size/1000)\naxs[1][0].set_xlabel(\"Mileage [Thousand of km]\")\naxs[1][0].set_ylabel(\"Count\")\n\n# Top 15 auto maker\nbins, counts = np.unique(df.make, return_counts=True)\ntop_idx = np.argsort(counts)[::-1]\nbins = bins[top_idx[:15]]\ncounts = counts[top_idx[:15]]\naxs[1][1].bar(bins, counts, edgecolor=\"black\", align=\"center\")\naxs[1][1].set_xticklabels(bins, rotation=45, ha='right')\naxs[1][1].text(9, 900, \"(Only showing the top 15 auto maker)\", va=\"center\", ha=\"center\")\npass\n```\n\n::: {.cell-output .cell-output-display}\n![Histogram for each column of the dataset.](index_files/figure-html/cell-4-output-1.png){width=950 height=758 fig-align='center'}\n:::\n:::\n\n\nTo examine the effect of engine type on vehicle price depreciation, we can calculate both the average and median prices for vehicles of varying ages.\n\n::: {.cell execution_count=4}\n``` {.python .cell-code}\nfig, axs = plt.subplots(1, 2, figsize=(10, 5), tight_layout=True, sharey=True)\n\navg_price_by_age = df.groupby(['vehicle_age', 'engine_type']).price.mean().reset_index()\nmed_price_by_age = df.groupby(['vehicle_age', 'engine_type']).price.median().reset_index()\n\n# Plotting\nsns.lineplot(data=avg_price_by_age, x='vehicle_age', y='price', hue='engine_type', marker=\"o\", ax=axs[0])\nsns.lineplot(data=med_price_by_age, x='vehicle_age', y='price', hue='engine_type', marker=\"o\", ax=axs[1])\naxs[0].set_title('Average Vehicle Price by Engine Type')\naxs[1].set_title('Median Vehicle Price by Engine Type')\naxs[0].set_xlabel('Vehicle Age (Years)')\naxs[1].set_xlabel('Vehicle Age (Years)')\naxs[0].set_ylabel('Price ($ CAD)')\naxs[0].legend(title='Engine Type')\npass\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-5-output-1.png){width=950 height=470}\n:::\n:::\n\n\n## Modeling\n\nTo validate this conclusion, I created a simple linear mixed-effect regression model to predict vehicle prices using mileage, age, and engine type. There are some biases that are unaccounted for: the options added to the vehicle and the MSRP. We still can get a rough estimate by inspecting the parameters of the learned model of the impact the engine type has on value depreciation.\n\n::: {.cell execution_count=5}\n``` {.python .cell-code}\nimport statsmodels.formula.api as smf\n\nmodel = smf.mixedlm(\"price ~ engine_type*mileage + engine_type*vehicle_age\", df, groups=\"MakeModel\").fit()\n\nprint(model.summary())\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                             Mixed Linear Model Regression Results\n================================================================================================\nModel:                         MixedLM             Dependent Variable:             price        \nNo. Observations:              10521               Method:                         REML         \nNo. Groups:                    626                 Scale:                          88717001.9691\nMin. group size:               1                   Log-Likelihood:                 -112977.0568 \nMax. group size:               239                 Converged:                      Yes          \nMean group size:               16.8                                                             \n------------------------------------------------------------------------------------------------\n                                        Coef.       Std.Err.    z    P>|z|   [0.025     0.975]  \n------------------------------------------------------------------------------------------------\nIntercept                                79703.870  2847.004  27.996 0.000  74123.844  85283.895\nengine_type[T.gasoline]                 -13121.545   909.000 -14.435 0.000 -14903.152 -11339.938\nmileage                                     -0.097     0.007 -13.308 0.000     -0.112     -0.083\nengine_type[T.gasoline]:mileage              0.022     0.008   2.609 0.009      0.005      0.038\nvehicle_age                              -3333.582   157.698 -21.139 0.000  -3642.665  -3024.500\nengine_type[T.gasoline]:vehicle_age        628.861   176.837   3.556 0.000    282.267    975.455\nMakeModel Var                       4686726889.814 29359.948                                    \n================================================================================================\n\n```\n:::\n:::\n\n\nWhat's most interesting about the results are the coefficients. We notice that, as expected and on average, every km driven (mileage) decreases the value of the vehicle by $0.097 and every year added decreases it by $3,333.58. The model uses EVs as a baseline, and we can notice that gasoline vehicles increase the value of the car by $0.022 for every km and $628.86 for every year. Now, these numbers are inexact; the relationship between these variables is most likely not linear. The sign of the coefficient is, however, undeniable: gasoline vehicles hold their value longer than their electrical counterparts.\n\n\n## Conclusion\n\nIt is evident that EVs undergo greater depreciation than gasoline cars. However, this difference appears primarily in vehicles older than 5 years. Five years ago marked a significant increase in the popularity of EVs in Canada, notably with the release of the Tesla Model 3. The technology has advanced considerably since then, and it is somewhat expected that the early models of EVs did not perform well in the market and are thus resold at lower values.\n\n",
    "supporting": [
      "index_files/figure-html"
    ],
    "filters": [],
    "includes": {}
  }
}